type tree = Leaf (int) | Node (tree,int,tree)

rotate (t:tree) : tree = rewrite t {
  | Leaf (i) -> Leaf (i)
  | Node (Node(a,i1,Node(b,i2,c)),i3,d) ->
    Node (Node(a,i1,b),i2,Node(c,i3,d))
  | Node (Node(Node(a,i1,b),i2,c),i3,d) ->
    Node (Node(a,i1,b),i2,Node(c,i3,d))
}
(*EXPECT
rotate (t : tree) : tree = rewrite t {
  | (i:int -- Cell(.Leaf-0) → Cell(.Leaf-0))
  | (b[]:tree -- Cell(.Node-0.Node-2.Node-0.Node-0^k1) → Cell(.Node-0.Node-2.Node-0^k1))
    (b.Leaf-0:int -- Cell(.Node-0.Node-2.Node-0.Node-0^k1.Leaf-0) → Cell(.Node-0.Node-2.Node-0^k1.Leaf-0))
    (b.Node-1:int -- Cell(.Node-0.Node-2.Node-0.Node-0^k1.Node-1) → Cell(.Node-0.Node-2.Node-0^k1.Node-1))
    (c:tree -- Layer(k3,.Node-0.Node-2.Node-2) → Layer(k3,.Node-2.Node-0))
    (d[]:tree -- Cell(.Node-2.Node-2^k4) → Cell(.Node-2.Node-2.Node-2^k4))
    (d.Leaf-0:int -- Cell(.Node-2.Node-2^k4.Leaf-0) → Cell(.Node-2.Node-2.Node-2^k4.Leaf-0))
    (d.Node-1:int -- Cell(.Node-2.Node-2^k4.Node-1) → Cell(.Node-2.Node-2.Node-2^k4.Node-1))
    (i1:int -- Cell(.Node-0.Node-1) → Cell(.Node-0.Node-1))
    (i2:int -- Cell(.Node-0.Node-2.Node-1) → Cell(.Node-1))
    (i3:int -- Cell(.Node-1) → Cell(.Node-2.Node-1))
  | (a[]:tree -- Cell(.Node-0.Node-0.Node-0.Node-0^k6) → Cell(.Node-0.Node-0.Node-0^k6))
    (a.Leaf-0:int -- Cell(.Node-0.Node-0.Node-0.Node-0^k6.Leaf-0) → Cell(.Node-0.Node-0.Node-0^k6.Leaf-0))
    (a.Node-1:int -- Cell(.Node-0.Node-0.Node-0.Node-0^k6.Node-1) → Cell(.Node-0.Node-0.Node-0^k6.Node-1))
    (b:tree -- Layer(k8,.Node-0.Node-0.Node-2) → Layer(k8,.Node-0.Node-2))
    (c:tree -- Layer(k9,.Node-0.Node-2) → Layer(k9,.Node-2.Node-0))
    (d[]:tree -- Cell(.Node-2.Node-2^k10) → Cell(.Node-2.Node-2.Node-2^k10))
    (d.Leaf-0:int -- Cell(.Node-2.Node-2^k10.Leaf-0) → Cell(.Node-2.Node-2.Node-2^k10.Leaf-0))
    (d.Node-1:int -- Cell(.Node-2.Node-2^k10.Node-1) → Cell(.Node-2.Node-2.Node-2^k10.Node-1))
    (i1:int -- Cell(.Node-0.Node-0.Node-1) → Cell(.Node-0.Node-1))
    (i2:int -- Cell(.Node-0.Node-1) → Cell(.Node-1))
    (i3:int -- Cell(.Node-1) → Cell(.Node-2.Node-1))
}

*)

